name: event-horizon-app

# DevPod configuration for Event Horizon App
# This configuration works with the existing .devcontainer setup

version: v1beta1

# Use the existing devcontainer configuration
devcontainer:
  devContainerFilePath: .devcontainer/devcontainer.json

# Provider configuration
provider: docker

# IDE configuration
ide: vscode

# Workspace configuration
workspace:
  # Mount the current directory
  mount: true
  
  # Forward ports for the application services
  ports:
    - name: frontend
      port: 5173
      description: "Frontend dev server"
    - name: backend
      port: 8000
      description: "Backend API server"
    - name: database
      port: 5432
      description: "PostgreSQL database"
    - name: n8n
      port: 5678
      description: "n8n automation platform"

# Environment variables
environment:
  - name: NODE_ENV
    value: development
  - name: PYTHONPATH
    value: /workspace/backend
  - name: DATABASE_URL
    value: postgresql://event_horizon_user:eventhorizon@localhost:5432/event_horizon

# Custom initialization commands
init:
  # The devcontainer setup.sh will handle most initialization
  # This runs after the container is created but before IDE connects
  command: |
    echo "🚀 Event Horizon App DevPod initialization..."
    echo "📋 The devcontainer setup will handle most configuration automatically"
    echo "🌐 After startup, run './start-dev.sh' to start all services"
    echo ""
    echo "📊 Services will be available at:"
    echo "   Frontend: http://localhost:5173"
    echo "   Backend: http://localhost:8000"
    echo "   API Docs: http://localhost:8000/docs"
    echo "   n8n: http://localhost:5678"

# Post-start commands
onCreate:
  # These commands run after the workspace is created
  command: |
    echo "🎯 DevPod workspace created successfully!"
    echo "📚 Useful commands:"
    echo "   ./start-dev.sh - Start all development services"
    echo "   ./generate-mock-data.sh - Generate mock data"
    echo "   ./run-tests.sh - Run all tests"
    echo ""
    echo "🔧 Development tips:"
    echo "   - Use the VS Code terminal to run commands"
    echo "   - All ports are automatically forwarded"
    echo "   - Database is initialized with mock data"
    echo "   - Git hooks are configured for code quality"

# Shutdown commands
onDestroy:
  command: |
    echo "🛑 DevPod workspace shutting down..."
    echo "💾 Any data in PostgreSQL volumes will be preserved"